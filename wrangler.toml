name = "vox-mind-api"
main = "workers/api.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Default environment variables (used in production deploy without --env flag)
[vars]
ENVIRONMENT = "production"
ALLOWED_ORIGINS = "https://vox-mind.pages.dev,http://localhost:3000,http://localhost:3001"
# R2 Presigned URL 생성에 필요 (실제 값으로 교체 필요)
CLOUDFLARE_ACCOUNT_ID = "c20598b7e5410e23541b2f02ee4c9478"

# Production environment
[env.production]
workers_dev = false

[env.production.vars]
ENVIRONMENT = "production"
ALLOWED_ORIGINS = "https://vox-mind.pages.dev,https://d8aef709.vox-mind.pages.dev"
# R2 Presigned URL 생성에 필요 (실제 값으로 교체 필요)
CLOUDFLARE_ACCOUNT_ID = "c20598b7e5410e23541b2f02ee4c9478"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "vox-mind-db"
database_id = "4d4a4eb0-45d3-4446-af7e-307416a93c9d"

[[env.production.d1_databases]]
binding = "DB"
database_name = "vox-mind-db"
database_id = "4d4a4eb0-45d3-4446-af7e-307416a93c9d"

# R2 Bucket
[[r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "vox-mind-audio-temp"

[[env.production.r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "vox-mind-audio-temp"

# Workers AI
[ai]
binding = "AI"

# Workflows
[[workflows]]
name = "vox-mind-process"
binding = "PROCESS_WORKFLOW"
class_name = "ProcessMemoWorkflow"

# Vectorize (1024d - BGE-M3)
[[vectorize]]
binding = "VECTORIZE"
index_name = "vox-mind-embeddings-v2"

# Production Workers AI
[env.production.ai]
binding = "AI"

# Production Workflows
[[env.production.workflows]]
name = "vox-mind-process"
binding = "PROCESS_WORKFLOW"
class_name = "ProcessMemoWorkflow"

# Production Vectorize
[[env.production.vectorize]]
binding = "VECTORIZE"
index_name = "vox-mind-embeddings-v2"
